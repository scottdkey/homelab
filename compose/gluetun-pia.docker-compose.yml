services:
  gluetun:
    image: qmcgaw/gluetun:latest
    container_name: gluetun
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    environment:
      - VPN_SERVICE_PROVIDER=private internet access
      - VPN_TYPE=openvpn
      - OPENVPN_USER=${PIA_USERNAME}
      - OPENVPN_PASSWORD=${PIA_PASSWORD}
      # Set specific server location (Montreal, Canada)
      # Using exact hostname for reliability
      - SERVER_HOSTNAMES=ca-montreal.privacy.network
      # Optional: Enable port forwarding for PIA
      - VPN_PORT_FORWARDING=on
      - VPN_PORT_FORWARDING_STATUS_FILE=/tmp/gluetun/forwarded_port
      - TZ=Etc/UTC
      # Enable HTTP proxy for other containers
      - HTTP_CONTROL_SERVER_LOG=on
    volumes:
      - gluetun_data:/gluetun
    ports:
      # HTTP proxy (for containers to route through VPN)
      - "8888:8888/tcp"
      # SOCKS5 proxy (optional)
      - "8388:8388/tcp"
      # Port forwarding (if enabled) - remapped to avoid conflicts
      - "18000:8000/tcp"
      - "18001:8001/tcp"
      - "18002:8002/tcp"
    networks:
      - vpn_network
    restart: unless-stopped

volumes:
  gluetun_data:
    name: gluetun_data

networks:
  vpn_network:
    name: vpn_network
    driver: bridge
